!function(d){function i(){l=[],d(s.imageSelector).each(function(e){if(!d(this).hasClass("loaded")){var i=c+=1;d(this).addClass(s.imageIdentifierPrefix+i);var t=parseInt(d(this).attr("data-width")),a=parseInt(d(this).attr("data-height")),r=s.defaultAspectRatio,o=d(this).attr("data-as-background");t&&a&&(r=a/t);var n=!1;1<=d(this).next("."+s.placeholderClass).length&&(n=!0),l.push({id:i,source:d(this).attr("data-src"),boundaries:{},hasPlaceholderImage:d(this).hasClass("lazyimage"),divPlaceholderExists:n,width:t,height:a,aspectRatio:r,asBackground:o,html:d(this)[0].outerHTML})}}),e(),o()}function t(){var e=function(){function e(){return d.grep(l,function(e){if(void 0===e)return!1;var i=d(window).scrollTop(),t=d(window).innerHeight(),a=i-200-s.threshold,r=i+t+200+s.threshold;return e.boundaries.top>=a&&e.boundaries.top<=r||e.boundaries.top<=a&&e.boundaries.bottom<=r&&e.boundaries.bottom>=a})}return r.resized?(r.resized=!1,o(e)):e()}();d(e).each(function(){var e=d("<img/>",{src:this.source}),t=this,a=l.map(function(e){return e.id}).indexOf(t.id);e.on("load",function(){delete l[a];var e=d("."+s.imageIdentifierPrefix+t.id),i=e.next("."+s.placeholderClass);e.attr("src",t.source),e.addClass("loaded"),t.asBackground?d("."+s.imageIdentifierPrefix+t.id).css({backgroundImage:"url("+t.source+")"}):t.hasPlaceholderImage||i.hide(),d(document).trigger("lazyimage-loaded",{type:"success",imageId:"."+s.imageIdentifierPrefix+t.id})}),e.on("error",function(){delete l[a],d(document).trigger("lazyimage-loaded",{type:"error",imageId:"."+s.imageIdentifierPrefix+t.id})})})}var a=!1,s={threshold:200,imageIdentifierPrefix:"lazy-image-",imageSelector:".lazy-image:not(.lazy-placeholder)",placeholderClass:"lazy-placeholder",defaultAspectRatio:1.777777778,loaderHtml:'<div class="loader"></div>'},r={viewportChanged:!1,touchScrolling:!1,resized:!1},l=[],c=0,e=function(){d(l).each(function(e){if(!this.hasPlaceholderImage&&!this.asBackground&&!this.divPlaceholderExists){var i=d("."+s.imageIdentifierPrefix+this.id),t=i.attr("class");"string"==typeof t&&(t=t.replace(s.imageIdentifierPrefix+this.id,""));var a=d("<div/>",{class:s.placeholderClass+" "+t});a.append(d("<div/>").css({height:0,"padding-bottom":100*this.aspectRatio+"%"})),a.append(d(s.loaderHtml)),a.insertAfter(i),l[e]&&(l[e].divPlaceholderExists=!0)}})},o=function(e){for(var i in l){var t=l[i],a=d("."+s.imageIdentifierPrefix+t.id),r=a.next("."+s.placeholderClass),o=0<r.length?r.offset().top:a.offset().top;t.boundaries={top:o,bottom:o+(0<r.length?r.outerHeight():a.outerHeight())},l[i]=t}if("function"==typeof e)return e()};d.lazyLoad=function(e){if("string"==typeof e)switch(e){case"refetchElements":i(),t()}else a||(a=!0,e&&(s=d.extend(s,e)),i(),setInterval(function(){!0!==r.viewportChanged&&!0!==r.touchScrolling||(t(),r.viewportChanged=!1,r.touchScrolling=!1)},250),d(document).on("touchmove",function(){r.touchScrolling=!0}),d(window).on("scroll resize",function(){r.viewportChanged=!0,r.touchScrolling=!1}),d(window).on("resize",function(){r.resized=!0}),t());return this}}(jQuery);