!function(e){var t=!1,i={threshold:200,imageIdentifierPrefix:"lazy-image-",imageSelector:".lazy-image:not(.lazy-placeholder)",placeholderClass:"lazy-placeholder",defaultAspectRatio:1.777777778,loaderHtml:'<div class="loader"></div>'},a={viewportChanged:!1,touchScrolling:!1,resized:!1},r=[],o=0,s=function(){r=[],e(i.imageSelector).each(function(t){if(!e(this).hasClass("loaded")){var a=o+=1;e(this).addClass(i.imageIdentifierPrefix+a);var s=parseInt(e(this).attr("data-width")),n=parseInt(e(this).attr("data-height")),d=i.defaultAspectRatio,l=e(this).attr("data-as-background");s&&n&&(d=n/s);var c=!1;e(this).next("."+i.placeholderClass).length>=1&&(c=!0),r.push({id:a,source:e(this).attr("data-src"),boundaries:{},hasPlaceholderImage:e(this).hasClass("lazyimage"),divPlaceholderExists:c,width:s,height:n,aspectRatio:d,asBackground:l,html:e(this)[0].outerHTML})}}),n(),l()},n=function(){e(r).each(function(t){if(!this.hasPlaceholderImage&&!this.asBackground&&!this.divPlaceholderExists){var a=e("."+i.imageIdentifierPrefix+this.id),o=a.attr("class");"string"==typeof o&&(o=o.replace(i.imageIdentifierPrefix+this.id,""));var s=e("<div/>",{class:i.placeholderClass+" "+o});s.append(e("<div/>").css({height:0,"padding-bottom":100*this.aspectRatio+"%"})),s.append(e(i.loaderHtml)),s.insertAfter(a),r[t]&&(r[t].divPlaceholderExists=!0)}})},d=function(){var t,o=(t=function(){return e.grep(r,function(t){if(void 0===t)return!1;var a=e(window).scrollTop(),r=e(window).innerHeight(),o=a-200-i.threshold,s=a+r+200+i.threshold;return t.boundaries.top>=o&&t.boundaries.top<=s||t.boundaries.top<=o&&t.boundaries.bottom<=s&&t.boundaries.bottom>=o})},a.resized?(a.resized=!1,l(t())):t());e(o).each(function(t){var a=e("<img/>",{src:this.source}),o=this;a.on("load",function(){delete r[t];var a=e("."+i.imageIdentifierPrefix+o.id),s=a.next("."+i.placeholderClass);a.attr("src",o.source),a.addClass("loaded"),o.asBackground?e("."+i.imageIdentifierPrefix+o.id).css({backgroundImage:"url("+o.source+")"}):o.hasPlaceholderImage||s.hide(),e(document).trigger("lazyimage-loaded",{type:"success",imageId:"."+i.imageIdentifierPrefix+o.id})}),a.on("error",function(){delete r[t],e(document).trigger("lazyimage-loaded",{type:"error",imageId:"."+i.imageIdentifierPrefix+o.id})})})},l=function(t){for(var a in r){var o=r[a],s=e("."+i.imageIdentifierPrefix+o.id),n=s.next("."+i.placeholderClass),d=n.length>0?n.offset().top:s.offset().top;o.boundaries={top:d,bottom:d+(n.length>0?n.outerHeight():s.outerHeight())},r[a]=o}if("function"==typeof t)return t()};e.lazyLoad=function(r){if("string"==typeof r)switch(r){case"refetchElements":s(),d()}else t||(t=!0,r&&(i=e.extend(i,r)),s(),setInterval(function(){!0!==a.viewportChanged&&!0!==a.touchScrolling||(d(),a.viewportChanged=!1,a.touchScrolling=!1)},250),e(document).on("touchmove",function(){a.touchScrolling=!0}),e(window).on("scroll resize",function(){a.viewportChanged=!0,a.touchScrolling=!1}),e(window).on("resize",function(){a.resized=!0}),d());return this}}(jQuery);