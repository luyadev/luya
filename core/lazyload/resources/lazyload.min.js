!function(e){var i=!1,t={threshold:200,imageIdentifierPrefix:"lazy-image-",imageSelector:".lazy-image:not(.lazy-placeholder)",placeholderClass:"lazy-placeholder",defaultAspectRatio:1.777777778,loaderHtml:'<div class="loader"></div>'},a={viewportChanged:!1,touchScrolling:!1,resized:!1},r=[],o=0,n=function(){r=[],e(t.imageSelector).each(function(i){if(!e(this).hasClass("loaded")){var a=o+=1;e(this).addClass(t.imageIdentifierPrefix+a);var n=parseInt(e(this).attr("data-width")),d=parseInt(e(this).attr("data-height")),s=t.defaultAspectRatio,l=e(this).attr("data-as-background");n&&d&&(s=d/n);var c=!1;e(this).next("."+t.placeholderClass).length>=1&&(c=!0),r.push({id:a,source:e(this).attr("data-src"),boundaries:{},hasPlaceholderImage:e(this).hasClass("lazyimage"),divPlaceholderExists:c,width:n,height:d,aspectRatio:s,asBackground:l,html:e(this)[0].outerHTML})}}),d(),l()},d=function(){e(r).each(function(i){if(!this.hasPlaceholderImage&&!this.asBackground&&!this.divPlaceholderExists){var a=e("."+t.imageIdentifierPrefix+this.id),o=a.attr("class");"string"==typeof o&&(o=o.replace(t.imageIdentifierPrefix+this.id,""));var n=e("<div/>",{class:t.placeholderClass+" "+o});n.append(e("<div/>").css({height:0,"padding-bottom":100*this.aspectRatio+"%"})),n.append(e(t.loaderHtml)),n.insertAfter(a),r[i]&&(r[i].divPlaceholderExists=!0)}})},s=function(){var i,o=(i=function(){return e.grep(r,function(i){if(void 0===i)return!1;var a=e(window).scrollTop(),r=e(window).innerHeight(),o=a-200-t.threshold,n=a+r+200+t.threshold;return i.boundaries.top>=o&&i.boundaries.top<=n||i.boundaries.top<=o&&i.boundaries.bottom<=n&&i.boundaries.bottom>=o})},a.resized?(a.resized=!1,l(i())):i());e(o).each(function(){var i=e("<img/>",{src:this.source}),a=this,o=r.map(function(e){return e.id}).indexOf(a.id);i.on("load",function(){delete r[o];var i=e("."+t.imageIdentifierPrefix+a.id),n=i.next("."+t.placeholderClass);i.attr("src",a.source),i.addClass("loaded"),a.asBackground?e("."+t.imageIdentifierPrefix+a.id).css({backgroundImage:"url("+a.source+")"}):a.hasPlaceholderImage||n.hide(),e(document).trigger("lazyimage-loaded",{type:"success",imageId:"."+t.imageIdentifierPrefix+a.id})}),i.on("error",function(){delete r[o],e(document).trigger("lazyimage-loaded",{type:"error",imageId:"."+t.imageIdentifierPrefix+a.id})})})},l=function(i){for(var a in r){var o=r[a],n=e("."+t.imageIdentifierPrefix+o.id),d=n.next("."+t.placeholderClass),s=d.length>0?d.offset().top:n.offset().top;o.boundaries={top:s,bottom:s+(d.length>0?d.outerHeight():n.outerHeight())},r[a]=o}if("function"==typeof i)return i()};e.lazyLoad=function(r){if("string"==typeof r)switch(r){case"refetchElements":n(),s()}else i||(i=!0,r&&(t=e.extend(t,r)),n(),setInterval(function(){!0!==a.viewportChanged&&!0!==a.touchScrolling||(s(),a.viewportChanged=!1,a.touchScrolling=!1)},250),e(document).on("touchmove",function(){a.touchScrolling=!0}),e(window).on("scroll resize",function(){a.viewportChanged=!0,a.touchScrolling=!1}),e(window).on("resize",function(){a.resized=!0}),s());return this}}(jQuery);