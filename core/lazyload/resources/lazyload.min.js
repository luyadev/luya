!function(e){var i=!1,t={threshold:200,imageIdentifierPrefix:"lazy-image-",imageSelector:".lazy-image:not(.lazy-placeholder)",placeholderClass:"lazy-placeholder",defaultAspectRatio:1.777777778,loaderHtml:'<div class="loader"></div>'},a={viewportChanged:!1,touchScrolling:!1,resized:!1},r=[],o=function(){e(t.imageSelector).each(function(i){if(!e(this).hasClass("loaded")){e(this).addClass(t.imageIdentifierPrefix+i);var a=parseInt(e(this).attr("data-width")),o=parseInt(e(this).attr("data-height")),s=t.defaultAspectRatio,d=e(this).attr("data-as-background");a&&o&&(s=o/a);var n=!1;e(this).next("."+t.placeholderClass).length>=1&&(n=!0),r.push({id:i,source:e(this).attr("data-src"),boundaries:{},hasPlaceholderImage:e(this).hasClass("lazyimage"),divPlaceholderExists:n,width:a,height:o,aspectRatio:s,asBackground:d,html:e(this)[0].outerHTML})}}),s(),n()},s=function(){e(r).each(function(){if(!this.hasPlaceholderImage&&!this.asBackground&&!this.divPlaceholderExists){var i=e("."+t.imageIdentifierPrefix+this.id),a=i.attr("class");"string"==typeof a&&(a=a.replace(t.imageIdentifierPrefix+this.id,""));var o=e("<div/>",{class:t.placeholderClass+" "+a});o.append(e("<div/>").css({height:0,"padding-bottom":100*this.aspectRatio+"%"})),o.append(e(t.loaderHtml)),o.insertAfter(i),r[this.id]&&(r[this.id].divPlaceholderExists=!0)}})},d=function(){var i,o=(i=function(){return e.grep(r,function(i){if(void 0===i)return!1;var a=e(window).scrollTop(),r=e(window).innerHeight(),o=a-200-t.threshold,s=a+r+200+t.threshold;return i.boundaries.top>=o&&i.boundaries.top<=s||i.boundaries.top<=o&&i.boundaries.bottom<=s&&i.boundaries.bottom>=o})},a.resized?(a.resized=!1,n(i())):i());e(o).each(function(){var i=e("<img/>",{src:this.source}),a=this;i.on("load",function(){delete r[a.id];var i=e("."+t.imageIdentifierPrefix+a.id),o=i.next("."+t.placeholderClass);i.attr("src",a.source),i.addClass("loaded"),a.asBackground?e("."+t.imageIdentifierPrefix+a.id).css({backgroundImage:"url("+a.source+")"}):a.hasPlaceholderImage||o.hide(),e(document).trigger("lazyimage-loaded",{type:"success",imageId:"."+t.imageIdentifierPrefix+a.id})}),i.on("error",function(){delete r[a.id],e(document).trigger("lazyimage-loaded",{type:"error",imageId:"."+t.imageIdentifierPrefix+a.id})})})},n=function(i){for(var a in r){var o=r[a],s=e("."+t.imageIdentifierPrefix+o.id),d=s.next("."+t.placeholderClass),n=d.length>0?d.offset().top:s.offset().top;o.boundaries={top:n,bottom:n+(d.length>0?d.outerHeight():s.outerHeight())},r[a]=o}if("function"==typeof i)return i()};e.lazyLoad=function(r){if("string"==typeof r)switch(r){case"refetchElements":o(),d()}else i||(i=!0,r&&(t=e.extend(t,r)),o(),setInterval(function(){!0!==a.viewportChanged&&!0!==a.touchScrolling||(d(),a.viewportChanged=!1,a.touchScrolling=!1)},250),e(document).on("touchmove",function(){a.touchScrolling=!0}),e(window).on("scroll resize",function(){a.viewportChanged=!0,a.touchScrolling=!1}),e(window).on("resize",function(){a.resized=!0}),d());return this}}(jQuery);