!function(t){var e=200,i="lazy-image-",o=".lazy-image:not(.lazy-placeholder)",a="lazy-placeholder",r=1.777777778,n='<div class="loader"></div>',s={viewportChanged:!1,touchScrolling:!1,resized:!1},d=[],c=function(){t(d).each(function(){if(!this.hasPlaceholderImage&&!this.asBackground&&!this.divPlaceholderExists){var e=t("."+i+this.id),o=e.attr("class");"string"==typeof o&&(o=o.replace(i+this.id,""));var r=t("<div/>",{class:a+" "+o});r.append(t("<div/>").css({height:0,"padding-bottom":100*this.aspectRatio+"%"})),r.append(t(n)),r.insertAfter(e),d[this.id]&&(d[this.id].divPlaceholderExists=!0)}})},h=function(){var o,r=(o=function(){return t.grep(d,function(i){if(void 0===i)return!1;var o=t(window).scrollTop(),a=t(window).innerHeight(),r=o-200-e,n=o+a+200+e;return i.boundaries.top>=r&&i.boundaries.top<=n||i.boundaries.top<=r&&i.boundaries.bottom<=n&&i.boundaries.bottom>=r})},s.resized?(s.resized=!1,l(o())):o());t(r).each(function(){var e=t("<img/>",{src:this.source}),o=this;e.on("load",function(){delete d[o.id];var e=t("."+i+o.id),r=e.next("."+a);e.attr("src",o.source),e.addClass("loaded"),o.asBackground?t("."+i+o.id).css({backgroundImage:"url("+o.source+")"}):o.hasPlaceholderImage||r.remove(),t(document).trigger("lazyimage-loaded",{type:"success",imageId:"."+i+o.id})}),e.on("error",function(){delete d[o.id],t(document).trigger("lazyimage-loaded",{type:"error",imageId:"."+i+o.id})})})},l=function(e){for(var o in d){var r=d[o],n=t("."+i+r.id),s=n.next("."+a),c=s.length>0?s.offset().top:n.offset().top;r.boundaries={top:c,bottom:c+(s.length>0?s.outerHeight():n.outerHeight())},d[o]=r}if("function"==typeof e)return e()};t.fn.lazyLoad=function(e){t(o).each(function(e){t(this).addClass(i+e);var o=parseInt(t(this).attr("data-width")),n=parseInt(t(this).attr("data-height")),s=r,c=t(this).attr("data-as-background");o&&n&&(s=n/o);var h=!1;t(this).next("."+a).length>=1&&(h=!0),d.push({id:e,source:t(this).attr("data-src"),boundaries:{},hasPlaceholderImage:t(this).hasClass("lazyimage"),divPlaceholderExists:h,width:o,height:n,aspectRatio:s,asBackground:c,html:t(this)[0].outerHTML})}),c(),l(),setInterval(function(){!0!==s.viewportChanged&&!0!==s.touchScrolling||(h(),s.viewportChanged=!1,s.touchScrolling=!1)},250),t(document).on("touchmove",function(){s.touchScrolling=!0}),t(window).on("scroll resize",function(){s.viewportChanged=!0,s.touchScrolling=!1}),t(window).on("resize",function(){s.resized=!0}),h()}}(jQuery);
