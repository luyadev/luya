!function(t){var e=200,o="lazy-image-",i=".lazy-image",a="lazy-placeholder",r=1.777777778,n='<div class="loader"></div>',d={viewportChanged:!1,touchScrolling:!1,resized:!1},s=[],c=function(){t(s).each(function(){if(!this.hasPlaceholderImage&&!this.asBackground){var e=t("."+o+this.id),i=e.attr("class");"string"==typeof i&&(i=i.replace(o+this.id,""));var r=t("<div/>",{class:a+" "+i});r.append(t("<div/>").css({height:0,"padding-bottom":100*this.aspectRatio+"%"})),r.append(t(n)),r.insertAfter(e)}})},u=function(){var i,r=(i=function(){return t.grep(s,function(o){if(void 0===o)return!1;var i=t(window).scrollTop(),a=t(window).innerHeight(),r=i-200-e,n=i+a+200+e;return o.boundaries.top>=r&&o.boundaries.top<=n||o.boundaries.top<=r&&o.boundaries.bottom<=n&&o.boundaries.bottom>=r})},d.resized?(d.resized=!1,h(i())):i());t(r).each(function(){var e=t("<img/>",{src:this.source}),i=this;e.on("load",function(){delete s[i.id];var e=t("."+o+i.id),r=e.next("."+a);e.attr("src",i.source),e.addClass("loaded"),i.asBackground?t("."+o+i.id).css({backgroundImage:"url("+i.source+")"}):i.hasPlaceholderImage||r.remove(),t(document).trigger("lazyimage-loaded",{type:"success",imageId:"."+o+i.id})}),e.on("error",function(){delete s[i.id],t(document).trigger("lazyimage-loaded",{type:"error",imageId:"."+o+i.id})})})},h=function(e){for(var i in s){var r=s[i],n=t("."+o+r.id),d=n.next("."+a),c=d.length>0?d.offset().top:n.offset().top;r.boundaries={top:c,bottom:c+(d.length>0?d.outerHeight():n.outerHeight())},s[i]=r}if("function"==typeof e)return e()};t.fn.lazyLoad=function(e){t(i).each(function(e){t(this).addClass(o+e);var i=parseInt(t(this).attr("data-width")),a=parseInt(t(this).attr("data-height")),n=r,d=t(this).attr("data-as-background");i&&a&&(n=a/i),s.push({id:e,source:t(this).attr("data-src"),boundaries:{},hasPlaceholderImage:t(this).hasClass("lazyimage"),width:i,height:a,aspectRatio:n,asBackground:d,html:t(this)[0].outerHTML})}),c(),h(),setInterval(function(){!0!==d.viewportChanged&&!0!==d.touchScrolling||(u(),d.viewportChanged=!1,d.touchScrolling=!1)},250),t(document).on("touchmove",function(){d.touchScrolling=!0}),t(window).on("scroll resize",function(){d.viewportChanged=!0,d.touchScrolling=!1}),t(window).on("resize",function(){d.resized=!0}),u()}}(jQuery);
